[
    {
        "client_msg_id": "c0b13510-f91e-45c5-a66c-471b458660fa",
        "type": "message",
        "text": "めちゃめちゃローテクですが、大量のcreated_atを取得する際は、投げられたハッシュタグごとに全created_atを保持するスプレッドシートを生成してキャッシュするようにしました。ページを開いて10秒くらいで表示される程度には改善：\n<https:\/\/observablehq.com\/d\/e489dca1b57d60d1>",
        "user": "UKS1Q2KTQ",
        "ts": "1632142578.044500",
        "team": "TKS1Q2JUE",
        "user_team": "TKS1Q2JUE",
        "source_team": "TKS1Q2JUE",
        "user_profile": {
            "avatar_hash": "g2cdaa6f0a3e",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/72cdaa6f0a3e75d134cc6b97d821b078.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0003-72.png",
            "first_name": "Yasuhiro",
            "real_name": "Yasuhiro Hashimoto",
            "display_name": "hashimoto",
            "team": "TKS1Q2JUE",
            "name": "yasuhirohashimoto",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "attachments": [
            {
                "title": "Monthly Hashtag Frequency in Twitter",
                "title_link": "https:\/\/observablehq.com\/d\/e489dca1b57d60d1",
                "text": "Tweets vs ReTweets Multiple Trend Time Series of Events Time Series of Multiple Events Appendix for Tweets vs ReTweet for Multiple Trend for Time Series of Events for Time Series of Multiple Events for Loading Point Process Data using <https:\/\/mongo-fastapi01.herokuapp.com\/api\/test\/> using <https:\/\/mongo-fastapi01.herokuapp.com\/api\/test2\/> Using The Cache Implementation on GAS",
                "fallback": "Monthly Hashtag Frequency in Twitter",
                "image_url": "https:\/\/static.observableusercontent.com\/thumbnail\/65976bbce2f7184d20475b609c8d0f3ead2b1d215729b0a3ce3e252892c58fe0.jpg",
                "from_url": "https:\/\/observablehq.com\/d\/e489dca1b57d60d1",
                "image_width": 400,
                "image_height": 250,
                "image_bytes": 19720,
                "service_icon": "https:\/\/observablehq.com\/favicon-512.png",
                "service_name": "observablehq.com",
                "id": 1,
                "original_url": "https:\/\/observablehq.com\/d\/e489dca1b57d60d1"
            }
        ],
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "kiC",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "めちゃめちゃローテクですが、大量のcreated_atを取得する際は、投げられたハッシュタグごとに全created_atを保持するスプレッドシートを生成してキャッシュするようにしました。ページを開いて10秒くらいで表示される程度には改善：\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/observablehq.com\/d\/e489dca1b57d60d1"
                            }
                        ]
                    }
                ]
            }
        ],
        "thread_ts": "1632142578.044500",
        "reply_count": 5,
        "reply_users_count": 2,
        "latest_reply": "1632148222.046100",
        "reply_users": [
            "UKS1Q2KTQ",
            "U01KC41PR9C"
        ],
        "replies": [
            {
                "user": "UKS1Q2KTQ",
                "ts": "1632142670.044700"
            },
            {
                "user": "U01KC41PR9C",
                "ts": "1632144660.045400"
            },
            {
                "user": "UKS1Q2KTQ",
                "ts": "1632145560.045600"
            },
            {
                "user": "U01KC41PR9C",
                "ts": "1632145971.045900"
            },
            {
                "user": "UKS1Q2KTQ",
                "ts": "1632148222.046100"
            }
        ],
        "is_locked": false,
        "subscribed": true,
        "last_read": "1632148222.046100",
        "reactions": [
            {
                "name": "eyes",
                "users": [
                    "U01KC41PR9C"
                ],
                "count": 1
            }
        ]
    },
    {
        "type": "message",
        "text": "こんな感じで：",
        "files": [
            {
                "id": "F02EZSM0NP4",
                "created": 1632142643,
                "timestamp": 1632142643,
                "name": "image.png",
                "title": "image.png",
                "mimetype": "image\/png",
                "filetype": "png",
                "pretty_type": "PNG",
                "user": "UKS1Q2KTQ",
                "editable": false,
                "size": 83870,
                "mode": "hosted",
                "is_external": false,
                "external_type": "",
                "is_public": true,
                "public_url_shared": false,
                "display_as_bot": false,
                "username": "",
                "url_private": "https:\/\/files.slack.com\/files-pri\/TKS1Q2JUE-F02EZSM0NP4\/image.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "url_private_download": "https:\/\/files.slack.com\/files-pri\/TKS1Q2JUE-F02EZSM0NP4\/download\/image.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "media_display_type": "unknown",
                "thumb_64": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_64.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_80": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_80.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_360": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_360.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_360_w": 360,
                "thumb_360_h": 231,
                "thumb_480": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_480.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_480_w": 480,
                "thumb_480_h": 308,
                "thumb_160": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_160.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_720": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_720.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_720_w": 720,
                "thumb_720_h": 461,
                "thumb_800": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_800.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_800_w": 800,
                "thumb_800_h": 513,
                "thumb_960": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_960.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_960_w": 960,
                "thumb_960_h": 615,
                "thumb_1024": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02EZSM0NP4-f4abe22295\/image_1024.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_1024_w": 1024,
                "thumb_1024_h": 656,
                "original_w": 1083,
                "original_h": 694,
                "thumb_tiny": "AwAeADDQwP1z1pQKT+PGKbQBJ+NH41HT06UALz60c+tLRQAgA60YHpQOlLQAmB6CloooAKKKKAP\/2Q==",
                "permalink": "https:\/\/css-uoa.slack.com\/files\/UKS1Q2KTQ\/F02EZSM0NP4\/image.png",
                "permalink_public": "https:\/\/slack-files.com\/TKS1Q2JUE-F02EZSM0NP4-e475ce4e6e",
                "is_starred": false,
                "has_rich_preview": false
            },
            {
                "id": "F02ET4QR04E",
                "created": 1632142667,
                "timestamp": 1632142667,
                "name": "image.png",
                "title": "image.png",
                "mimetype": "image\/png",
                "filetype": "png",
                "pretty_type": "PNG",
                "user": "UKS1Q2KTQ",
                "editable": false,
                "size": 59145,
                "mode": "hosted",
                "is_external": false,
                "external_type": "",
                "is_public": true,
                "public_url_shared": false,
                "display_as_bot": false,
                "username": "",
                "url_private": "https:\/\/files.slack.com\/files-pri\/TKS1Q2JUE-F02ET4QR04E\/image.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "url_private_download": "https:\/\/files.slack.com\/files-pri\/TKS1Q2JUE-F02ET4QR04E\/download\/image.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "media_display_type": "unknown",
                "thumb_64": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02ET4QR04E-6145b6b016\/image_64.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_80": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02ET4QR04E-6145b6b016\/image_80.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_360": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02ET4QR04E-6145b6b016\/image_360.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_360_w": 360,
                "thumb_360_h": 354,
                "thumb_480": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02ET4QR04E-6145b6b016\/image_480.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_480_w": 480,
                "thumb_480_h": 472,
                "thumb_160": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02ET4QR04E-6145b6b016\/image_160.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_720": "https:\/\/files.slack.com\/files-tmb\/TKS1Q2JUE-F02ET4QR04E-6145b6b016\/image_720.png?t=xoxe-672058086966-2523672994084-2517456103667-564347be5337331371fc88513b8caa70",
                "thumb_720_w": 720,
                "thumb_720_h": 708,
                "original_w": 732,
                "original_h": 720,
                "thumb_tiny": "AwAvADDRwQWJPB7elGTjjpSFiO1CndnNADuaQUoGKWgBM0ZpaKAGPQnehqVO9ADqKKKACiiigBjUqd6RqVOM0AOooooAKKKKAP\/Z",
                "permalink": "https:\/\/css-uoa.slack.com\/files\/UKS1Q2KTQ\/F02ET4QR04E\/image.png",
                "permalink_public": "https:\/\/slack-files.com\/TKS1Q2JUE-F02ET4QR04E-a3ad6d334c",
                "is_starred": false,
                "has_rich_preview": false
            }
        ],
        "upload": false,
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "995",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "こんな感じで："
                            }
                        ]
                    }
                ]
            }
        ],
        "user": "UKS1Q2KTQ",
        "ts": "1632142670.044700",
        "client_msg_id": "12f8de8f-eaff-4758-9813-a00613f18866",
        "thread_ts": "1632142578.044500",
        "parent_user_id": "UKS1Q2KTQ"
    },
    {
        "client_msg_id": "695d1b56-085c-4d84-bfde-62bb5c164282",
        "type": "message",
        "text": "<@UKS1Q2KTQ> 大量取得のAPIが遅い原因の一つが、Elasticsearch自体にありました。\n10000件ずつ取得していくクエリを直接発行したところ、結果が返るまでに`20s`かかり、1000件ずつでは`2s`でした。\n単純が結果を返すまでで`20s`、それにHerokuへのやり取りが加味されて遅くなっているようです。\n明日はもう少し効果的なクエリが無いか研究してみます。",
        "user": "U01KC41PR9C",
        "ts": "1632144660.045400",
        "team": "TKS1Q2JUE",
        "user_team": "TKS1Q2JUE",
        "source_team": "TKS1Q2JUE",
        "user_profile": {
            "avatar_hash": "5ab4b4b51ee4",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-01-23\/1653062663351_5ab4b4b51ee430a5e180_72.jpg",
            "first_name": "Tomoaki",
            "real_name": "Tomoaki Yoshino",
            "display_name": "yoshino",
            "team": "TKS1Q2JUE",
            "name": "t409828543087",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "VV=",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "user",
                                "user_id": "UKS1Q2KTQ"
                            },
                            {
                                "type": "text",
                                "text": " 大量取得のAPIが遅い原因の一つが、Elasticsearch自体にありました。\n10000件ずつ取得していくクエリを直接発行したところ、結果が返るまでに`20s`かかり、1000件ずつでは`2s`でした。\n単純が結果を返すまでで`20s`、それにHerokuへのやり取りが加味されて遅くなっているようです。\n明日はもう少し効果的なクエリが無いか研究してみます。"
                            }
                        ]
                    }
                ]
            }
        ],
        "thread_ts": "1632142578.044500",
        "parent_user_id": "UKS1Q2KTQ"
    },
    {
        "client_msg_id": "54371b92-81fb-43f4-8bd8-97f2386de183",
        "type": "message",
        "text": "つまりヒットする件数にかかわらず、要求する数で変わるということですかね？例えば、10,000件ヒットする場合、n=10000を1回呼ぶのとn=1000を10回呼ぶのとではどっちが速いかな？",
        "user": "UKS1Q2KTQ",
        "ts": "1632145560.045600",
        "team": "TKS1Q2JUE",
        "user_team": "TKS1Q2JUE",
        "source_team": "TKS1Q2JUE",
        "user_profile": {
            "avatar_hash": "g2cdaa6f0a3e",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/72cdaa6f0a3e75d134cc6b97d821b078.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0003-72.png",
            "first_name": "Yasuhiro",
            "real_name": "Yasuhiro Hashimoto",
            "display_name": "hashimoto",
            "team": "TKS1Q2JUE",
            "name": "yasuhirohashimoto",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "vmgFo",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "つまりヒットする件数にかかわらず、要求する数で変わるということですかね？例えば、10,000件ヒットする場合、n=10000を1回呼ぶのとn=1000を10回呼ぶのとではどっちが速いかな？"
                            }
                        ]
                    }
                ]
            }
        ],
        "thread_ts": "1632142578.044500",
        "parent_user_id": "UKS1Q2KTQ",
        "reactions": [
            {
                "name": "man-gesturing-ok",
                "users": [
                    "U01KC41PR9C"
                ],
                "count": 1
            }
        ]
    },
    {
        "client_msg_id": "f1c047ff-9b1d-4069-a588-4b1ef20a7f26",
        "type": "message",
        "text": "最終的にはn=10000の方が早いです。\nというのも、Elasticsearch自体は最初に検索した際に結果を保持しているため、n=10000もn=1000も速度に差はありません。\nしかし、Herokuで整形を行っているため、回数が多いとその分遅くなります。\n加えて、Elasticsearchはアメリカサーバーで動いているため、通信回数は少ない方がいいです。",
        "user": "U01KC41PR9C",
        "ts": "1632145971.045900",
        "team": "TKS1Q2JUE",
        "user_team": "TKS1Q2JUE",
        "source_team": "TKS1Q2JUE",
        "user_profile": {
            "avatar_hash": "5ab4b4b51ee4",
            "image_72": "https:\/\/avatars.slack-edge.com\/2021-01-23\/1653062663351_5ab4b4b51ee430a5e180_72.jpg",
            "first_name": "Tomoaki",
            "real_name": "Tomoaki Yoshino",
            "display_name": "yoshino",
            "team": "TKS1Q2JUE",
            "name": "t409828543087",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "h+a",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "最終的にはn=10000の方が早いです。\nというのも、Elasticsearch自体は最初に検索した際に結果を保持しているため、n=10000もn=1000も速度に差はありません。\nしかし、Herokuで整形を行っているため、回数が多いとその分遅くなります。\n加えて、Elasticsearchはアメリカサーバーで動いているため、通信回数は少ない方がいいです。"
                            }
                        ]
                    }
                ]
            }
        ],
        "thread_ts": "1632142578.044500",
        "parent_user_id": "UKS1Q2KTQ"
    },
    {
        "client_msg_id": "8aeb382f-8d72-4396-84ad-119569895e08",
        "type": "message",
        "text": "なるほど、Thank you!",
        "user": "UKS1Q2KTQ",
        "ts": "1632148222.046100",
        "team": "TKS1Q2JUE",
        "user_team": "TKS1Q2JUE",
        "source_team": "TKS1Q2JUE",
        "user_profile": {
            "avatar_hash": "g2cdaa6f0a3e",
            "image_72": "https:\/\/secure.gravatar.com\/avatar\/72cdaa6f0a3e75d134cc6b97d821b078.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0003-72.png",
            "first_name": "Yasuhiro",
            "real_name": "Yasuhiro Hashimoto",
            "display_name": "hashimoto",
            "team": "TKS1Q2JUE",
            "name": "yasuhirohashimoto",
            "is_restricted": false,
            "is_ultra_restricted": false
        },
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "6t6K",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "なるほど、Thank you!"
                            }
                        ]
                    }
                ]
            }
        ],
        "thread_ts": "1632142578.044500",
        "parent_user_id": "UKS1Q2KTQ"
    }
]